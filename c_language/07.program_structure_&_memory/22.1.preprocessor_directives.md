# 22: Preprocessor Directives in C

Before your C program is **compiled**, it first goes through the **preprocessor**.
The preprocessor handles **commands starting with `#`**, called **preprocessor directives**.

They control:

* Including header files (`#include`)
* Defining constants/macros (`#define`)
* Conditional compilation (`#ifdef`, `#ifndef`, `#endif`)

Let’s go step by step.

---

## 1) `#include` – Including Header Files

* Brings in external code (functions, constants, macros) before compilation.
* Two types:

### A) Standard library headers (angle brackets `< >`)

```c
#include <stdio.h>   // standard input-output functions
#include <math.h>    // math functions
```

> Compiler searches these files in **system directories**.

### B) User-defined headers (double quotes `" "`)

```c
#include "myheader.h"
```

> Compiler searches in **current directory first**, then system directories.

**Example:**

**main.c**

```c
#include <stdio.h>
#include "myheader.h"

int main() {
    hello();  // function defined in myheader.h
    return 0;
}
```

**myheader.h**

```c
void hello() {
    printf("Hello from header file!\n");
}
```

**Output**

```
Hello from header file!
```

---

## 2) `#define` – Macros & Constants

* Defines symbolic names (constants) or macros.
* Preprocessor **replaces them** before compilation.

### A) Constants

```c
#include <stdio.h>
#define PI 3.14159

int main() {
    printf("Circle area = %.2f\n", PI * 5 * 5);
    return 0;
}
```

**Output**

```
Circle area = 78.54
```

---

### B) Function-like Macros

```c
#include <stdio.h>
#define SQUARE(x) ((x) * (x))

int main() {
    printf("Square of 5 = %d\n", SQUARE(5));
    printf("Square of (3+2) = %d\n", SQUARE(3+2)); // expands to ((3+2)*(3+2))
    return 0;
}
```

**Output**

```
Square of 5 = 25
Square of (3+2) = 25
```

> ⚠️ Danger: macros don’t check types or errors. Prefer `inline` functions in modern C.

---

## 3) Conditional Compilation

Useful to:

* Compile code only on certain platforms
* Enable/disable debug features
* Avoid multiple inclusion of headers

### A) `#ifdef` / `#endif`

```c
#include <stdio.h>
#define DEBUG

int main() {
#ifdef DEBUG
    printf("Debug mode ON\n");
#endif
    printf("Program running...\n");
    return 0;
}
```

**Output**

```
Debug mode ON
Program running...
```

---

### B) `#ifndef` – If Not Defined

```c
#include <stdio.h>
#ifndef PI
#define PI 3.14
#endif

int main() {
    printf("PI = %.2f\n", PI);
    return 0;
}
```

If PI wasn’t already defined, it gets defined here.

---

### C) `#if`, `#elif`, `#else`, `#endif`

```c
#include <stdio.h>
#define VERSION 2

int main() {
#if VERSION == 1
    printf("Version 1 features\n");
#elif VERSION == 2
    printf("Version 2 features\n");
#else
    printf("Unknown version\n");
#endif
    return 0;
}
```

**Output**

```
Version 2 features
```

---

## 4) Common Use: Header Guards

To avoid **multiple inclusion of a header file**, we use `#ifndef`:

```c
#ifndef MYHEADER_H
#define MYHEADER_H

// function prototypes
void hello();

#endif
```

This ensures the file is included **only once**, even if multiple `#include`s appear.

---

## 5) Key Takeaways

* `#include` → pull in external code (system or user headers).
* `#define` → constants and macros (replaced before compilation).
* `#ifdef` / `#ifndef` → conditional compilation.
* Use header guards to avoid multiple inclusion.

---
