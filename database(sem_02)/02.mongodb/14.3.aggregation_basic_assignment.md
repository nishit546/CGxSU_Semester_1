# MongoDB Aggregation Basic Assignment




> [!IMPORTANT]
> **Mandatory Instructions (Must Be Followed Strictly)**
> These instructions are mandatory and are designed to reflect real backend / data-engineering practices. All learners are expected to follow them strictly.

##  Data Source Rules
- All questions must be solved using the provided `users` and `orders` collections only.
- **Creating new data is strictly prohibited.**
- **Modifying existing documents is NOT allowed.**
- **Inserting additional records into the collection is NOT permitted** (beyond the initial setup).

## Database Configuration
- **Database Name:** Flipkart
- **Collection Names:** `users`, `orders`

> [!WARNING]
> **ðŸš« Usage Restrictions**
> - âŒ `find()` is NOT allowed.
> - âŒ Update operations are NOT allowed.
> - âŒ Delete operations are NOT allowed.
> - âœ… Only `aggregate()` must be used.
> - âœ… **Allowed Stages:** `$match`, `$project`, `$group`, `$lookup`, `$unwind`, `$sort`, `$limit`, `$skip`.
> - âœ… **Allowed Operators:** `$sum`, `$avg`, `$min`, `$max`, `$size`, `$cond`, `$ifNull` (and other standard aggregation operators).

## Execution Rules (Very Important)
1. Every aggregation query must first be written and executed in **Mongo Shell (mongosh)**.
2. The output of each query must be carefully verified.
3. Result must correctly satisfy the questionâ€™s requirement.
4. If output is incorrect, the query must be corrected and re-tested.

## Submission Process
- Only verified aggregation queries should be written on paper.
- âŒ Writing queries directly on paper without testing is **NOT acceptable**.
- âŒ Guess-based answers are **strictly prohibited**.
- Queries written on paper must exactly match the verified Mongo Shell queries.

---

## Data Setup Script

Run this script to initialize your database:

```javascript
// Switch to Database
use Flipkart

// Users Collection
db.users.insertMany([
  { _id: 1, name: "Amit Sharma", city: "Delhi", membership: "Plus" },
  { _id: 2, name: "Priya Verma", city: "Mumbai", membership: "Regular" },
  { _id: 3, name: "Rahul Singh", city: "Bangalore", membership: "Plus" },
  { _id: 4, name: "Sneha Kapoor", city: "Delhi", membership: "Regular" },
  { _id: 5, name: "Vikram Rao", city: "Hyderabad", membership: "Plus" },
  { _id: 6, name: "Anjali Mehta", city: "Pune", membership: "Regular" },
  { _id: 7, name: "Rohit Yadav", city: "Chennai", membership: "Plus" },
  { _id: 8, name: "Neha Gupta", city: "Kolkata", membership: "Regular" },
  { _id: 9, name: "Karan Malhotra", city: "Jaipur", membership: "Plus" },
  { _id: 10, name: "Pooja Nair", city: "Ahmedabad", membership: "Regular" }
]);

// Orders Collection
db.orders.insertMany([
  { _id: 101, product: "iPhone 14", price: 70000, userId: 1 },
  { _id: 102, product: "Samsung TV", price: 45000, userId: 2 },
  { _id: 103, product: "Boat Headphones", price: 3000, userId: 1 },
  { _id: 104, product: "Dell Laptop", price: 65000, userId: 3 },
  { _id: 105, product: "Nike Shoes", price: 5000, userId: 4 },
  { _id: 106, product: "HP Printer", price: 12000, userId: 5 },
  { _id: 107, product: "Mi Tablet", price: 18000, userId: 2 },
  { _id: 108, product: "Canon Camera", price: 55000, userId: 6 },
  { _id: 109, product: "Apple Watch", price: 40000, userId: 7 },
  { _id: 110, product: "Gaming Mouse", price: 2000, userId: 8 }
]);
```

---



## ðŸŸ¢ LEVEL 1 â€“ BASIC $lookup (8 Questions)

### Q1.
Using `$lookup`, display all users along with the complete list of orders they have placed.
The result must contain a new field called `orders` which stores matching order documents.

### Q2.
Display only the following fields:
- user name
- city
- orders

Do not display `_id` or `membership` in the final output.

### Q3.
Retrieve all users who belong to **Delhi** city, along with the products they have ordered.

### Q4.
Find all users who have **Plus** membership and display their corresponding orders.

### Q5.
Display only those users who have placed at least one order.
Users without orders must not appear in the output.

### Q6.
Display users who have not placed any order.
Only users with empty order arrays should be shown.

### Q7.
Find the users who ordered the product "**iPhone 14**".
Display the user name and matching order details.

### Q8.
Display all users along with the total number of orders they have placed.
Output fields:
- name
- totalOrders

---

## ðŸŸ¡ LEVEL 2 â€“ BASIC $lookup (22 Questions)

### Q9.
Find users who have purchased products costing more than **â‚¹50,000**.
Display only the expensive order details.

### Q10.
Retrieve users whose total purchase amount exceeds **â‚¹60,000**.

### Q11.
Find users who have placed exactly one order.

### Q12.
Find users who have placed more than one order.

### Q13.
Display users who purchased either "**iPhone 14**" OR "**Apple Watch**".

### Q14.
Retrieve users from **Mumbai** city who purchased products costing more than **â‚¹10,000**.

### Q15.
Find **Plus** members who purchased products costing more than **â‚¹30,000**.

### Q16.
Display **Regular** members who purchased products costing less than **â‚¹20,000**.

### Q17.
Retrieve users who purchased at least one product costing less than **â‚¹5,000**.

### Q18.
Find users whose total spending is between **â‚¹40,000** and **â‚¹80,000**.

### Q19.
Display users who purchased at least one product containing the word "**Apple**".

### Q20.
Find users who purchased products in different price ranges (example: one above **â‚¹40,000** and another below **â‚¹10,000**).

### Q21.
Find users who purchased exactly two products.

### Q22.
Display users who have purchased products above **â‚¹20,000** but belong to **Regular** membership.

### Q23.
Find users who purchased products only above **â‚¹30,000** (no cheap product).

### Q24.
Retrieve users whose average order value is greater than **â‚¹25,000**.

### Q25.
Display users whose highest order price is above **â‚¹60,000**.

### Q26.
Find users whose lowest order price is below **â‚¹3,000**.

### Q27.
Retrieve users who have purchased products from at least two different price slabs:
- â‚¹0â€“10,000
- â‚¹10,001â€“40,000
- Above â‚¹40,000

### Q28.
Find users whose total number of orders is greater than the average number of orders across all users.

### Q29.
Display users whose total spending is greater than **â‚¹50,000** but less than **â‚¹1,00,000**.

### Q30.
Retrieve users from **Delhi** or **Mumbai** who have placed at least one order.

---

## ðŸ”µ LEVEL 3 â€“ INTERMEDIATE $lookup + $group (20 Questions)

### Q31.
Calculate total spending for each user and display results in descending order of spending.

### Q32.
Find the top 3 users based on total spending.

### Q33.
Calculate city-wise total revenue generated from orders.

### Q34.
Calculate membership-wise total revenue (**Plus** vs **Regular**).

### Q35.
Find the city that generated the highest revenue.

### Q36.
Find the membership type that generated the highest revenue.

### Q37.
Calculate total number of orders placed by **Plus** members.

### Q38.
Calculate total number of orders placed by **Regular** members.

### Q39.
Find the user who placed the most expensive order.

### Q40.
Find the product that generated the highest total revenue.

### Q41.
Find users whose total spending is greater than the overall average spending of all users.

### Q42.
Calculate average order value across all users.

### Q43.
Find users who have placed orders worth more than **50%** of their total spending in a single order.

### Q44.
Generate a report containing:
- name
- city
- membership
- totalOrders
- totalSpending

### Q45.
Generate city-wise report containing:
- total users
- total orders
- total revenue

### Q46.
Generate membership-wise report containing:
- total users
- total orders
- total revenue

### Q47.
Find users who purchased both expensive (> **â‚¹50,000**) and low-cost (< **â‚¹5,000**) products.

### Q48.
Find users who never purchased any product above **â‚¹40,000**.

### Q49.
Calculate cumulative revenue generated by all orders.

### Q50.
Generate a complete analytical report for each user including:
- name
- city
- membership
- totalOrders
- totalSpending
- highestOrderValue
- lowestOrderValue
- averageOrderValue
