# MongoDB Aggregation Basic Assignment

> [!IMPORTANT]
> **Mandatory Instructions (Must Be Followed Strictly)**
> These instructions are mandatory and are designed to reflect real backend / data-engineering practices. All learners are expected to follow them strictly.

##  Data Source Rules
- All questions must be solved using the provided `users` and `orders` collections only.
- **Creating new data is strictly prohibited.**
- **Modifying existing documents is NOT allowed.**
- **Inserting additional records into the collection is NOT permitted** (beyond the initial setup).

## Database Configuration
- **Database Name:** Flipkart
- **Collection Names:** `users`, `orders`

> [!WARNING]
> **üö´ Usage Restrictions**
> - ‚ùå `find()` is NOT allowed.
> - ‚ùå Update operations are NOT allowed.
> - ‚ùå Delete operations are NOT allowed.
> - ‚úÖ Only `aggregate()` must be used.
> - ‚úÖ **Allowed Stages:** `$match`, `$project`, `$group`, `$lookup`, `$unwind`, `$sort`, `$limit`, `$skip`.


## Execution Rules (Very Important)
1. Every aggregation query must first be written and executed in **Mongo Shell (mongosh)**.
2. The output of each query must be carefully verified.
3. Result must correctly satisfy the question‚Äôs requirement.
4. If output is incorrect, the query must be corrected and re-tested.

## Submission Process
- Only verified aggregation queries should be written on paper.
- ‚ùå Writing queries directly on paper without testing is **NOT acceptable**.
- ‚ùå Guess-based answers are **strictly prohibited**.
- Queries written on paper must exactly match the verified Mongo Shell queries.

---

## Data Setup Script

Run this script to initialize your database:

```javascript
// Switch to Database
use Flipkart

// Users Collection
db.users.insertMany([
  { _id: 1, name: "Amit Sharma", city: "Delhi", membership: "Plus" },
  { _id: 2, name: "Priya Verma", city: "Mumbai", membership: "Regular" },
  { _id: 3, name: "Rahul Singh", city: "Bangalore", membership: "Plus" },
  { _id: 4, name: "Sneha Kapoor", city: "Delhi", membership: "Regular" },
  { _id: 5, name: "Vikram Rao", city: "Hyderabad", membership: "Plus" },
  { _id: 6, name: "Anjali Mehta", city: "Pune", membership: "Regular" },
  { _id: 7, name: "Rohit Yadav", city: "Chennai", membership: "Plus" },
  { _id: 8, name: "Neha Gupta", city: "Kolkata", membership: "Regular" },
  { _id: 9, name: "Karan Malhotra", city: "Jaipur", membership: "Plus" },
  { _id: 10, name: "Pooja Nair", city: "Ahmedabad", membership: "Regular" }
]);

// Orders Collection
db.orders.insertMany([
  { _id: 101, product: "iPhone 14", price: 70000, userId: 1 },
  { _id: 102, product: "Samsung TV", price: 45000, userId: 2 },
  { _id: 103, product: "Boat Headphones", price: 3000, userId: 1 },
  { _id: 104, product: "Dell Laptop", price: 65000, userId: 3 },
  { _id: 105, product: "Nike Shoes", price: 5000, userId: 4 },
  { _id: 106, product: "HP Printer", price: 12000, userId: 5 },
  { _id: 107, product: "Mi Tablet", price: 18000, userId: 2 },
  { _id: 108, product: "Canon Camera", price: 55000, userId: 6 },
  { _id: 109, product: "Apple Watch", price: 40000, userId: 7 },
  { _id: 110, product: "Gaming Mouse", price: 2000, userId: 8 }
]);
```

---


## LEVEL 1 ‚Äì VERY BASIC $lookup (10 Questions)

### Q1.
Using `$lookup`, display all users along with the list of orders they have placed.
The result must contain a new field named `orders` which stores the matching order documents for each user.

### Q2.
Display all users with their orders, but show only the following fields:
- name
- city
- orders

Do not display `_id` or `membership`.

### Q3.
Retrieve all users who belong to **Delhi** city and display their orders.

### Q4.
Retrieve all users who belong to **Mumbai** city and display their orders.

### Q5.
Display all users who have **Plus** membership along with their orders.

### Q6.
Display all users who have **Regular** membership along with their orders.

### Q7.
Find users who have placed at least one order.
Users without orders must not appear in the output.

### Q8.
Find users who have not placed any order.
Only users with empty order arrays should be displayed.

### Q9.
Display all users along with the total number of orders they have placed.

### Q10.
Display all users and sort them in ascending order by their name, along with their orders.

---

## LEVEL 2 ‚Äì BASIC FILTERING AFTER $lookup (20 Questions)

### Q11.
Display users who have ordered the product "**iPhone 14**".

### Q12.
Display users who have ordered the product "**Samsung TV**".

### Q13.
Display users who have purchased products costing more than **‚Çπ50,000**.

### Q14.
Display users who have purchased products costing less than **‚Çπ10,000**.

### Q15.
Retrieve users who have purchased a product costing exactly **‚Çπ40,000**.

### Q16.
Display users who have placed more than one order.

### Q17.
Display users who have placed exactly one order.

### Q18.
Retrieve users from **Delhi** who have placed at least one order.

### Q19.
Retrieve users from **Mumbai** who have placed at least one order.

### Q20.
Display users who purchased the product "**Apple Watch**".

### Q21.
Display users who purchased the product "**Dell Laptop**".

### Q22.
Display users who have placed orders and sort the results by order price in descending order.

### Q23.
Display users whose orders cost more than **‚Çπ20,000** and sort them by price in ascending order.

### Q24.
Display users and show only the product name and price inside the orders array.

### Q25.
Retrieve users who purchased products costing between **‚Çπ10,000** and **‚Çπ50,000**.

### Q26.
Display users who purchased at least one product containing the word "**Apple**" in its name.

### Q27.
Display users and limit the result to first 5 users after performing `$lookup`.

### Q28.
Display users and skip the first 3 users after performing `$lookup`.

### Q29.
Retrieve users who have purchased products costing greater than **‚Çπ30,000** and belong to **Plus** membership.

### Q30.
Retrieve users who belong to **Delhi** or **Mumbai** and display their orders.

---

## LEVEL 3 ‚Äì SIMPLE GROUPING PRACTICE (20 Questions)



### Q31.
Calculate total spending of each user.

### Q32.
Calculate average order value of each user.

### Q33.
Find the highest order price for each user.

### Q34.
Find the lowest order price for each user.

### Q35.
Display total number of orders placed by each user.

### Q36.
Calculate total revenue generated by each city.

### Q37.
Calculate total revenue generated by **Plus** members.

### Q38.
Calculate total revenue generated by **Regular** members.

### Q39.
Find the user who placed the most expensive order.

### Q40.
Find the product with the highest price.

### Q41.
Calculate the total revenue generated by all orders.

### Q42.
Display city-wise total number of users.

### Q43.
Display membership-wise total number of users.

### Q44.
Display city-wise total number of orders.

### Q45.
Display membership-wise total number of orders.

### Q46.
Display total number of products sold (count of orders).

### Q47.
Display users sorted by total spending in descending order.

### Q48.
Display top 3 most expensive orders with user details.

### Q49.
Display users and their total spending, sorted from lowest to highest.

### Q50.
Generate a simple report for each user showing:
- name
- city
- membership
- totalOrders
- totalSpending
